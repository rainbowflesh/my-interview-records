DROP EXTENSION IF EXISTS timescaledb;
CREATE EXTENSION IF NOT EXISTS timescaledb;
DROP TABLE IF EXISTS "rides";
CREATE TABLE "rides"(
    vendor_id TEXT,
    pickup_datetime TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    dropoff_datetime TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    passenger_count NUMERIC,
    trip_distance NUMERIC,
    pickup_longitude NUMERIC,
    pickup_latitude NUMERIC,
    rate_code INTEGER,
    dropoff_longitude NUMERIC,
    dropoff_latitude NUMERIC,
    payment_type INTEGER,
    fare_amount NUMERIC,
    extra NUMERIC,
    mta_tax NUMERIC,
    tip_amount NUMERIC,
    tolls_amount NUMERIC,
    improvement_surcharge NUMERIC,
    total_amount NUMERIC
);
-- SELECT create_hypertable(
--         'rides',
--         'pickup_datetime',
--         'payment_type',
--         2,
- - create_default_indexes = > FALSE --);
-- 
CREATE INDEX ON rides (vendor_id, pickup_datetime desc);
CREATE INDEX ON rides (pickup_datetime desc, vendor_id);
CREATE INDEX ON rides (rate_code, pickup_datetime DESC);
CREATE INDEX ON rides (passenger_count, pickup_datetime desc);
DROP TABLE IF EXISTS "payment_types";
CREATE TABLE IF NOT EXISTS "payment_types"(
    payment_type INTEGER,
    description TEXT
);
INSERT INTO payment_types(payment_type, description)
VALUES (1, 'credit card'),
    (2, 'cash'),
    (3, 'no charge'),
    (4, 'dispute'),
    (5, 'unknown'),
    (6, 'voided trip');
DROP TABLE IF EXISTS "rates";
CREATE TABLE IF NOT EXISTS "rates"(rate_code INTEGER, description TEXT);
INSERT INTO rates(rate_code, description)
VALUES (1, 'standard rate'),
    (2, 'JFK'),
    (3, 'Newark'),
    (4, 'Nassau or Westchester'),
    (5, 'negotiated fare'),
    (6, 'group ride');
INSERT INTO public.rides(
        vendor_id,
        pickup_datetime,
        dropoff_datetime,
        passenger_count,
        trip_distance,
        pickup_longitude,
        pickup_latitude,
        rate_code,
        dropoff_longitude,
        dropoff_latitude,
        payment_type,
        fare_amount,
        extra,
        mta_tax,
        tip_amount,
        tolls_amount,
        improvement_surcharge,
        total_amount
    )
VALUES (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:11',
        1,
        1.2,
        -73.97942352,
        40.74461365,
        1,
        -73.99203491,
        40.7539444,
        2,
        9,
        0.5,
        0.5,
        0,
        0,
        0.3,
        10.3
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:11',
        1,
        6,
        -73.94715118,
        40.79104614,
        1,
        -73.92076874,
        40.8655777,
        2,
        18,
        0.5,
        0.5,
        0,
        0,
        0.3,
        19.3
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:14',
        1,
        3.7,
        -74.00430298,
        40.74224091,
        1,
        -74.00736237,
        40.70693588,
        1,
        14,
        0.5,
        0.5,
        3.05,
        0,
        0.3,
        18.35
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:14',
        2,
        2.2,
        -73.99199677,
        40.71857834,
        1,
        -74.00513458,
        40.73994446,
        1,
        11,
        0.5,
        0.5,
        1.5,
        0,
        0.3,
        13.8
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:04',
        1,
        1.7,
        -73.98210144,
        40.77469635,
        1,
        -73.97093964,
        40.79670715,
        1,
        7,
        0.5,
        0.5,
        1.65,
        0,
        0.3,
        9.95
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:20',
        2,
        4.9,
        -73.95303345,
        40.67211533,
        1,
        -73.98657227,
        40.71059418,
        1,
        19,
        0.5,
        0.5,
        4.06,
        0,
        0.3,
        24.36
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:09',
        1,
        1.8,
        -73.98916626,
        40.7265892,
        1,
        -74.00948334,
        40.71507263,
        2,
        9,
        0.5,
        0.5,
        0,
        0,
        0.3,
        10.3
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:19',
        3,
        5.3,
        -73.99713135,
        40.73696136,
        1,
        -73.92842102,
        40.7555809,
        1,
        18,
        0.5,
        0.5,
        3.85,
        0,
        0.3,
        23.15
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:07',
        2,
        1.2,
        -73.96391296,
        40.71217346,
        1,
        -73.95133209,
        40.71220016,
        2,
        7,
        0.5,
        0.5,
        0,
        0,
        0.3,
        8.3
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:13',
        1,
        2.4,
        -73.99559784,
        40.74423981,
        1,
        -73.98545837,
        40.76871109,
        1,
        11,
        0.5,
        0.5,
        3.05,
        0,
        0.3,
        15.35
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:33',
        2,
        2.9,
        -73.98215485,
        40.77487946,
        1,
        -73.98136139,
        40.74411392,
        2,
        20.5,
        0.5,
        0.5,
        0,
        0,
        0.3,
        21.8
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:19',
        1,
        1.2,
        -74.00806427,
        40.74206924,
        1,
        -74.00228882,
        40.74216461,
        3,
        12.5,
        0.5,
        0.5,
        0,
        0,
        0.3,
        13.8
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:13',
        1,
        1.5,
        -74.00267792,
        40.7306366,
        1,
        -73.98042297,
        40.72621155,
        1,
        10,
        0.5,
        0.5,
        3.35,
        0,
        0.3,
        14.65
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:19',
        1,
        3.4,
        0,
        0,
        1,
        0,
        0,
        2,
        14.5,
        0.5,
        0.5,
        0,
        0,
        0.3,
        15.8
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:29',
        1,
        13,
        -73.98223877,
        40.75770187,
        1,
        -73.90930939,
        40.8620491,
        2,
        36.5,
        0.5,
        0.5,
        0,
        0,
        0.3,
        37.8
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:17',
        1,
        0.7,
        -73.89412689,
        40.63657379,
        1,
        -73.89250183,
        40.63483429,
        2,
        11,
        0.5,
        0.5,
        0,
        0,
        0.3,
        12.3
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:32',
        1,
        5.4,
        -73.94641876,
        40.78913879,
        1,
        -73.91590118,
        40.85154724,
        2,
        24.5,
        0.5,
        0.5,
        0,
        0,
        0.3,
        25.8
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:07',
        1,
        1.3,
        -73.96588135,
        40.6885643,
        1,
        -73.96269226,
        40.67192841,
        1,
        7.5,
        0.5,
        0.5,
        1.75,
        0,
        0.3,
        10.55
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:17',
        1,
        4.7,
        -73.99586487,
        40.76777267,
        1,
        -74.00960541,
        40.70992661,
        1,
        17,
        0.5,
        0.5,
        2,
        0,
        0.3,
        20.3
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:22',
        1,
        15.4,
        -73.97650146,
        40.73356247,
        1,
        -73.85426331,
        40.89178848,
        1,
        41.5,
        0.5,
        0.5,
        8.55,
        0,
        0.3,
        51.35
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:15',
        1,
        5.1,
        -73.99058533,
        40.74588013,
        1,
        -73.96988678,
        40.80126572,
        1,
        17.5,
        0.5,
        0.5,
        2.82,
        0,
        0.3,
        21.62
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:03',
        1,
        1.3,
        -73.93352509,
        40.80292892,
        1,
        -73.94567108,
        40.78598404,
        2,
        5.5,
        0.5,
        0.5,
        0,
        0,
        0.3,
        6.8
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:10',
        1,
        3.7,
        -73.97831726,
        40.76317978,
        1,
        -73.92160797,
        40.74137497,
        1,
        13,
        0.5,
        0.5,
        5.7,
        0,
        0.3,
        20
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:06',
        1,
        1.2,
        -73.97602081,
        40.74456024,
        1,
        -73.9664917,
        40.75366211,
        1,
        6.5,
        0.5,
        0.5,
        2.3,
        0,
        0.3,
        10.1
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:17',
        1,
        8.8,
        -73.97679138,
        40.7336998,
        1,
        -73.89214325,
        40.75072479,
        1,
        26,
        0.5,
        0.5,
        5.45,
        0,
        0.3,
        32.75
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:08',
        1,
        2.2,
        -73.96987152,
        40.76850891,
        1,
        -73.94934845,
        40.7877655,
        2,
        9,
        0.5,
        0.5,
        0,
        0,
        0.3,
        10.3
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:14',
        1,
        4.3,
        -73.96617889,
        40.76222229,
        1,
        -73.89775848,
        40.74314117,
        2,
        15.5,
        0.5,
        0.5,
        0,
        0,
        0.3,
        16.8
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:11',
        2,
        1.3,
        -74.00437927,
        40.74225235,
        1,
        -73.98422241,
        40.73819733,
        1,
        8.5,
        0.5,
        0.5,
        1,
        0,
        0.3,
        10.8
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:03',
        1,
        0.8,
        -73.97915649,
        40.74050903,
        1,
        -73.98852539,
        40.73464584,
        1,
        4.5,
        0.5,
        0.5,
        1.45,
        0,
        0.3,
        7.25
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:13',
        2,
        8.7,
        -73.95392609,
        40.76694489,
        1,
        -73.92446136,
        40.86139297,
        1,
        25,
        0.5,
        0.5,
        0,
        0,
        0.3,
        26.3
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:29',
        2,
        3.1,
        -73.98404694,
        40.75527954,
        1,
        -73.99514771,
        40.72063446,
        1,
        19.5,
        0.5,
        0.5,
        4.15,
        0,
        0.3,
        24.95
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:08',
        3,
        1.8,
        -73.98387146,
        40.74240875,
        1,
        -74.00236511,
        40.72634888,
        2,
        8,
        0.5,
        0.5,
        0,
        0,
        0.3,
        9.3
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:22',
        1,
        4.9,
        -73.98508453,
        40.74716568,
        1,
        -73.95803833,
        40.71749115,
        1,
        19,
        0.5,
        0.5,
        1.7,
        0,
        0.3,
        22
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:17',
        1,
        1.1,
        -73.98415375,
        40.76485825,
        1,
        -73.97802734,
        40.76293564,
        2,
        11,
        0.5,
        0.5,
        0,
        0,
        0.3,
        12.3
    ),
    (
        1,
        '1/1/2016 00:00',
        '1/1/2016 00:17',
        1,
        5.7,
        -73.9877243,
        40.75056839,
        1,
        -74.03556824,
        40.71357346,
        1,
        18,
        0.5,
        0.5,
        8,
        10.5,
        0.3,
        37.8
    ),
    (
        1,
        '1/1/2016 00:01',
        '1/1/2016 00:19',
        1,
        3.2,
        -74.00213623,
        40.76063919,
        1,
        -73.97289276,
        40.74345016,
        1,
        14.5,
        0.5,
        0.5,
        3.15,
        0,
        0.3,
        18.95
    ),
    (
        1,
        '1/1/2016 00:01',
        '1/1/2016 00:17',
        1,
        2.7,
        -73.99497223,
        40.76023483,
        1,
        -74.00152588,
        40.7358551,
        1,
        13,
        0.5,
        0.5,
        4.25,
        0,
        0.3,
        18.55
    ),
    (
        1,
        '1/1/2016 00:01',
        '1/1/2016 00:23',
        1,
        5,
        -74.00226593,
        40.73036957,
        1,
        -73.95168304,
        40.77349854,
        1,
        19.5,
        0.5,
        0.5,
        4.5,
        0,
        0.3,
        25.3
    ),
    (
        1,
        '1/1/2016 00:01',
        '1/1/2016 00:06',
        2,
        1.6,
        -73.98082733,
        40.7796402,
        1,
        -73.97141266,
        40.7985878,
        1,
        6.5,
        0.5,
        0.5,
        1.55,
        0,
        0.3,
        9.35
    ),
    (
        1,
        '1/1/2016 00:01',
        '1/1/2016 00:36',
        2,
        6,
        -73.99944305,
        40.72983551,
        1,
        -73.96417999,
        40.80315399,
        1,
        25.5,
        0.5,
        0.5,
        5.36,
        0,
        0.3,
        32.16
    );