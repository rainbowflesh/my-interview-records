# The Answer

## æ€è€ƒé¢˜

> postgresql å’Œ timescale æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ

ç­”: TimescaleDB æ˜¯åŸºäº PostgreSQL çš„æ—¶åºæ•°æ®åº“, ä½œä¸º PostgreSQL çš„ä¸€ä¸ªæ’ä»¶å­˜åœ¨.

> ä½ä»£ç å¹³å°çš„åº•å±‚çš„åŸºæœ¬å·¥ä½œåŸç†ï¼Ÿ

ç­”:

å°†å¤æ‚çš„ä»£ç ç¼–å†™è¿‡ç¨‹è¿›è¡Œæå‰å°è£…, åº•å±‚æ¶æ„è¿›è¡Œæå‰è®¾è®¡, å°†è¿™äº›å¤æ‚çš„å†…å®¹åŒ…è£…æˆå¯è§†åŒ–çš„æ¨¡å—. å‚ç…§ NocoBase çš„æ¶æ„, NocoBase å°†æ•´ä¸ªä½ä»£ç å¹³å°åˆ†ä¸º "å®¢æˆ·ç«¯" ä¸ "æœåŠ¡ç«¯" ä¸¤ä¸ªéƒ¨åˆ†, å®¢æˆ·ç«¯ç”¨æ¥å®Œæˆå¯è§†åŒ–ç¼–è¾‘çš„å·¥ä½œ, æœåŠ¡ç«¯åˆ™æ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚, å¹¶ä¸”è¿›è¡Œæ•°æ®åº“çš„æ“ä½œ.

- æ­¤æ—¶åˆ†ç±»è®¨è®º:

    1. ç•Œé¢æ¸²æŸ“

        - ä»è¡¨ç°å½¢å¼æ¥çœ‹: ä½ä»£ç éœ€è¦æ»¡è¶³å¯è§†åŒ–çš„ç¼–è¾‘, å³èƒ½è®©ä¸ä¼šç¼–ç¨‹çš„äººä¹Ÿè½»æ¾åˆ›å»ºè½¯ä»¶, ä¾¿éœ€è¦åŠæ—¶åœ¨å›¾å½¢ç•Œé¢ä¸Šæ¸²æŸ“å½“å‰æ“ä½œä»¥åŠåé¦ˆ; å‚è€ƒ amis çš„å®ç°: ç”¨æˆ·åœ¨å›¾å½¢ç•Œé¢ä¸Šæ‰§è¡Œçš„æ“ä½œ, éƒ½ä¼šå½¢æˆä¸€ä¸ªé…ç½®, ä»¤æ¸²æŸ“å™¨ / æœåŠ¡ç«¯è§£æé…ç½®, è½¬æ¢æˆå¯¹åº”çš„å›¾å½¢ç•Œé¢å…ƒç´ æˆ–ç»„ä»¶, å¹¶åŠæ—¶æ¸²æŸ“å‡ºæ¥.

    2. äº¤äº’é€»è¾‘çš„

        - å•ä¸€çš„é€šè¿‡å›¾å½¢åŒ–, ä¹Ÿå°±æ˜¯æ‹–æ‹½ä»£ç å—å½¢å¼çš„ä½ä»£ç æ¨¡å¼, æ˜¯æ— æ³•å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘çš„, æ‰€ä»¥å¤šæ•°ä½ä»£ç æ¨¡å¼éƒ½é€‰æ‹©äº†å›ºåŒ–äº¤äº’è¡Œä¸º, å³å°†å¸¸è§å¸¸ç”¨çš„æ“ä½œ / ç•Œé¢ / æ¨¡å—é¢„åˆ¶æˆå›ºå®šçš„ç»„ä»¶ç›´æ¥ä½¿ç”¨, å“ªæ€•å¤æ‚çš„é€»è¾‘ä¹Ÿå¯ä»¥å°è£…æˆç®€å•çš„ç»„ä»¶, è®©ç”¨æˆ·ä½¿ç”¨æ—¶æ— æ„ŸçŸ¥.

    3. è‡ªå®šä¹‰æ•°æ®å­˜å‚¨

        - ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“; NocoBase çš„ "Collections & Fields" åŠŸèƒ½ä¸­ç›´æ¥åˆ›å»ºæ•°æ®åº“è¡¨, æ— éœ€ä»¤æ•°æ®åº“ç®¡ç†å‘˜æˆ–ä¸šåŠ¡äººå‘˜å»åˆ›å»ºè¡¨, ä½†æ˜¯ä¼šè¦†ç›–å·²ç»å­˜åœ¨çš„åŒåè¡¨. åŒæ—¶ NocoBase æä¾›äº†ç”¨æˆ·è§’è‰²æ§åˆ¶.
        - ä½¿ç”¨æ–‡æ¡£å‹æ•°æ®åº“; ä»¥ MongoDB ä¸ºä¾‹, ç”¨æˆ·åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰è¡¨çš„æ—¶å€™, ç³»ç»Ÿå°±è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª collection, æ‰€æœ‰è¿™ä¸ªè¡¨çš„æ•°æ®éƒ½å­˜åœ¨è¿™ä¸ª collection é‡Œ. ç”¨æˆ·æ–°å¢å­—æ®µçš„æ—¶å€™, å°±éšæœºåˆ†é…ä¸€ä¸ª fileId, åç»­å¯¹è¿™ä¸ªå­—æ®µçš„æ“ä½œéƒ½è‡ªåŠ¨æ˜ å°„åˆ°è¿™ä¸ª fileId ä¸Š, ç”¨ fileId çš„å¥½å¤„æ˜¯ç”¨æˆ·é‡å‘½åå­—æ®µåè¿˜èƒ½æŸ¥æ‰¾ä¹‹å‰çš„æ•°æ®, å› ä¸ºæ‰€æœ‰æ•°æ®æŸ¥è¯¢åº•å±‚éƒ½åŸºäºè¿™ä¸ª fileId. æŸ¥è¯¢çš„æ—¶å€™å…ˆæ‰¾åˆ°å¯¹åº”çš„ collection, å†é€šè¿‡ meta ä¿¡æ¯æŸ¥è¯¢å­—æ®µå¯¹åº”çš„ fileId, ä½¿ç”¨è¿™ä¸ª fileId æ¥è·å–æ•°æ®.

    4. åç«¯ä¸šåŠ¡é€»è¾‘

        - ä¸å‰ç«¯ç±»ä¼¼, éœ€è¦è€ƒè™‘å›¾å½¢ç¼–è¾‘å™¨ä¸å›ºåŒ–äº¤äº’è¡Œä¸º, åŒæ—¶è¿˜è¦ç®€åŒ– DSL è¯­è¨€, æ¯”å¦‚è¡¨è¾¾å¼è®¡ç®—.
        - æµç¨‹; å¸¸è§äºå·¥ä½œæµ, ä¾‹å¦‚ä¸‰ä¸ªç”¨æˆ·åŒæ­¥æˆ–å¼‚æ­¥å®¡æ‰¹åŒä¸€ä»½è¡¨æ ¼. æµç¨‹å¯è§†åŒ–å·²ç»æœ‰äº†è§„èŒƒ (BPMN), è¡Œä¸ºå°±å’Œçœ‹èµ·æ¥çš„ä¸€æ ·, æ¯ä¸€ä¸ªæµç¨‹éƒ½å‘ä¸‹ä¸€ä¸ªæµç¨‹ä¼ é€’æ•°æ®, å½¢å¦‚:

```json
{
    // something like 0;
  "lines": [
    {
      "id": "1",
      "to": "2",
      "from": "0"
    },
    {
      "id": "2",
      "to": "3",
      "from": "1"
    }
  ],
  "nodes": [
    {
      "id": "1",
      "type": "start",
      "label": "å¼€å§‹"
    },
    {
      "id": "2",
      "type": "examine-and-approve-task",
      "label": "å®¡æ‰¹"
    },
    {
      "id": "3",
      "type": "end",
      "label": "ç»“æŸ"
    }
  ]
}
```

[å‚è€ƒ](https://zhuanlan.zhihu.com/p/451340998)

## å®ç°

> å…è®¸ç”¨æˆ¶åœ¨ç•Œé¢ä¸Šç»„åˆçº½çº¦å‡ºç§Ÿâ»‹æµ‹è¯•é›†çš„ä»»ä½• field è¿›è¡Œé€‰æ‹©æŸ¥è¯¢, æ¯ä¸ªæŸ¥è¯¢é»˜è®¤éƒ½è¦é™åˆ¶ç»“æœæ•°é‡

ç­”: ![preview](asset/any_field_preview_0.png) ![preview](asset/any_field_preview_1.png)

NocoBase æä¾›çš„ "table" ç»„ä»¶, å¯ä»¥é€‰æ‹©ç°å®å­—æ®µ, åŒæ—¶é™„å¸¦äº† "filter" åŠŸèƒ½ä»¥åŠåˆ†é¡µæŸ¥è¯¢, ä½¿ç”¨æ—¶çš„è¡¨ç°å½¢å¦‚ SQL:

```sql
SELECT "column" FROM "table" WHERE "filter_condition" LIMIT "page_size"
```

> è®¸ç”¨æˆ¶åœ¨ç•Œé¢ä¸Šç»„åˆçº½çº¦å‡ºç§Ÿâ»‹æµ‹è¯•é›†çš„éƒ¨åˆ† field è¿›è¡ŒèšåˆæŸ¥è¯¢

ç­”: NocoBase è¿˜æœªå®ç°èšåˆå‡½æ•°çš„åŠŸèƒ½, åœ¨[æ–‡æ¡£](https://docs-cn.nocobase.com/roadmap)ä¸­æœ‰æ‰€è¡¨ç¤º: æ­£åœ¨å¼€å‘ plugin èšåˆè®¡ç®—å­—æ®µ;

æŒ‰ç…§ç¼–ç çš„é€»è¾‘, åœ¨åç«¯å®ç°ä¸€ä¸ªè‡ªå®šä¹‰æŸ¥è¯¢åŠŸèƒ½, å‚æ•°æ¥è‡ªå‰ç«¯è¯·æ±‚çš„ "body", ä¾‹å¦‚:

```json
{
    "query": {
        "table": "table_name",
        "columns": ["column_name"],
        "filters": [
            {
                "field": "field_name",
                "operator": "operator_name",
                "value": "value_name"
            }
        ],
        "pagination": {
            "page_size": 10,
            "page_index": 1
        }
    }
}
```

åç«¯å‚è€ƒ mybatis-plus, ä¾‹å¦‚:

```java
// æ ¹æ® Wrapper æ¡ä»¶, æŸ¥è¯¢æ€»è®°å½•æ•°
int count(Wrapper<T> queryWrapper);
```

å…¶ SQL å½¢å¦‚:

```sql
SELECT COUNT(*) FROM "table_name" WHERE "field_name" "operator_name" "value_name"
```

> æŸ¥è¯¢ç»“æœé›†çš„å±•ç¤ºæ”¯æŒ 2 ç§ï¼šè¡¨æ ¼, ç‚¹çº¿å›¾

ç­”: åŒä¸Š, NocoBase æœªå®ç°, æˆ–è€…è¯´åªå®ç°äº†å‰ç«¯çš„å±•ç¤ºæ•ˆæœ, æ²¡æœ‰åç«¯çš„ CRUD æ”¯æŒ, åªèƒ½æ‰‹åŠ¨å¡«å…¥æ•°æ®, çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„: ![chart](asset/line_chart_preview_0.png)

æŒ‰ç…§ä¼ ç»Ÿç¼–ç , æˆ‘ä¼šé€‰æ‹©ä½¿ç”¨ Apache Echarts å®ç°å›¾è¡¨, é€‰ç”¨æœ€åŸºç¡€çš„ "Basic Line Chart" ç»„ä»¶å³å¯.

```ts
option = {
  xAxis: {
    type: 'category',
    data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
  },
  yAxis: {
    type: 'value'
  },
  series: [
    {
      data: [150, 230, 224, 218, 135, 147, 260],
      type: 'line'
    }
  ]
};
```

å‰ç«¯åªéœ€è¦å°†å…¶ä¸­çš„ "type", "data" å­—æ®µç»‘å®šæˆåç«¯ä¼ æ¥çš„æ•°æ®å³å¯.
åç«¯ä¾æ—§å‚ç…§ mybatis-plus:

```java
// æ ¹æ® Wrapper æ¡ä»¶æŸ¥è¯¢å…¨éƒ¨è®°å½•
List<Map<String, Object>> selectMaps(@Param(Constants.WRAPPER) Wrapper<T> queryWrapper);
```

åªéœ€è¦æ„é€ ä¸€ä¸ª Wrapper å¯¹è±¡å³å¯, å…¶å†…å®¹å¯ä»¥å›ºå®š, ä¹Ÿå¯ä»¥ä»å‰ç«¯å‘é€æ¡ä»¶.

> å…è®¸åœ¨å‰ç«¯æŒ‰è®¾å®šæ—¶é—´è½®è¯¢åå°æ•°æ®åº“, å¹¶æ›´æ–°ç‚¹çº¿å›¾

ç­”:
åŒæ ·, å®ç°å›¾è¡¨å, ä»¤å‰ç«¯çš„è¯·æ±‚ body ä¸­å«æœ‰æ—¶é—´åŒºé—´:

```json
{
    // something else...
    "timescale_start":"iamtime",
    "timescale_end":"iamtime2"
}
```

ä»¤åç«¯è§£ææ—¶é—´åŒºé—´çš„å¼€å§‹ä¸ç»“æŸ, åˆ›å»ºè½®è¯¢ä»»åŠ¡å¹¶è¿”å›, å½¢å¦‚:

```java
// service implement
for(timescale_start<=timescale_end) {
    // æŸ¥è¯¢æ•°æ®åº“
    List<Map<String, Object>> data = selectMaps(Wrapper<T> queryWrapper);
    // æ›´æ–°å›¾è¡¨
    updateChart(data);
    // ç¡çœ æˆ–è€…é—´éš”
    Thread.sleep(1000);
    // å¢åŠ æ—¥æœŸ
    timescale_start++;
}
// controller
@RestController
// @Api(value = "/chart", tags = "æŸå›¾è¡¨")
public record ChartController(ChartService chartService) {
    // do something else...
    @PostMapping("/v1/someChart")
    // @ApiOperation(value = "someChart", notes = "æŸå›¾è¡¨")
    public HttpResult someChartAction(@RequestBody someChartData data) {
        return chartService.someChart(data);
    }
}
```

## é™„åŠ ç‚¹

> èƒ½å¦å…è®¸ç”¨æˆ¶å‘èµ·æŸ¥è¯¢æ—¶è‡ªå®šä¹‰ç»“æœé›†å¤§å°ï¼Ÿ

ç­”: èƒ½, NocoBase ä½¿ç”¨åˆ†é¡µæ¥è‡ªå®šä¹‰å¤§å°.

> èƒ½å¦å…è®¸ç”¨æˆ¶è‡ªå®šä¹‰â€œç»´åº¦â€å’Œâ€œæ•°å€¼â€ï¼Ÿ

ç­”: èƒ½, NocoBase æä¾›äº†è¡¨å•ç»„ä»¶, å¯ä»¥ä¿®æ”¹å­—æ®µä¸‹çš„å†…å®¹.

> ä½ä»£ç å¹³å°çš„æ˜¯å¦æœ‰å¾ˆå¥½çš„æœºåˆ¶æ‰©å±•ï¼Ÿæ¯”å¦‚pluginæœºåˆ¶, æŠŠ3.dä¸­çš„å®šåˆ¶åŒ–é€»è¾‘æ”¾å…¥pluginï¼Ÿ

ç­”: ä»‹äº NocoBase çš„æ’ä»¶éƒ¨åˆ†çš„æ–‡æ¡£æ²¡æœ‰å†…å®¹, æˆ‘è®¤ä¸º, ä½ä»£ç å¹³å°å¿…è¦å®ç°å¯ç§»æ¤æ€§ / å…¼å®¹æ€§ / å¯æ‰©å±•æ€§çš„è¯, æ’ä»¶æœºåˆ¶æ˜¯å¿…è¦çš„, å¦‚ 3.d ä¸­çš„åŠŸèƒ½æ˜¯å¯ä»¥å‚è€ƒ "table" ä¸­çš„ "filter" ä¸€æ ·é›†æˆè¿›å»çš„.

> æ‰©å±•æ€è€ƒï¼šå¦‚æœåµŒå…¥ä¸€ä¸ªwasmæ¡†æ¶ä»¥å¢å¼ºå¹³å°çš„æŸäº›æ–¹é¢æ˜¯å¦å¯è¡Œï¼Ÿ

ç­”: å°±æˆ‘äº†è§£çš„ wasm æŠ€æœ¯ä¸­, å¤§å¤šæ•°æ˜¯ç”¨æ¥è§£å†³ js è¿ç®—é€Ÿåº¦è¿‡æ…¢çš„é—®é¢˜, å€˜è‹¥æœ‰éœ€è¦éå¸¸é«˜æ€§èƒ½å¼€é”€çš„ä¸šåŠ¡, ä½¿ç”¨ wasm ä¹Ÿæœªå°ä¸å¯. è€Œå¼•å…¥ wasm æ¡†æ¶, è¿˜è¦è€ƒè™‘å¼•å…¥çš„æ–¹å¼, ä¾‹å¦‚æ˜¯å°† wasm ç¼–è¯‘å¥½çš„æ–‡ä»¶ç›´æ¥å°è£…æˆä½ä»£ç å¹³å°çš„æ’ä»¶, è¿˜æ˜¯åˆ›é€ æŸç§ä¸­é—´ä»¶æ’ä»¶, èƒ½å¤Ÿé€‚é…å¤šæ•° wasm åº”ç”¨è€Œæ— éœ€ç›´æ¥å°è£…æˆæ’ä»¶.

> æ·»åŠ ä¸€ä¸ªçƒ­åŠ›åœ°å›¾å±•ç¤ºæ¯ä¸ªè¡Œç¨‹çš„èµ·ç‚¹å’Œç»ˆç‚¹çš„ï¼ˆå¯èƒ½æœ‰æ€§èƒ½é—®é¢˜ï¼‰ï¼Ÿ

ç­”: åŒæ ·å‚è€ƒ Apache Echarts (Heatmap on Baidu Map Extension).
![map with heat](asset/heatmap.png)
![heat](asset/heatmap-bmap.png)

å°± Echarts çš„å®ç°è€Œè¨€, çƒ­åŠ›åœ°å›¾éœ€è¦æä¾›åœ°å›¾ api, åœ¨åœ°å›¾ api ç»™å‡ºçš„åœ°å›¾ç”»é¢çš„åŸºç¡€ä¸Šè¦†ç›–ç‚¹çš„ä½ç½®, æ˜¾ç¤ºçƒ­åŠ›åœ°å›¾.

æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹å¿…ç„¶æ˜¯ä¼šå¼•èµ·æ€§èƒ½é—®é¢˜çš„, æ­¤æ—¶è‹¥æƒ³åˆ©ç”¨ wasm æŠ€æœ¯é™ä½æ€§èƒ½å¼€é”€, æˆ‘è®¤ä¸ºé€‚åˆçš„æ–¹æ¡ˆæ˜¯é‡æ–°é€ è½®å­, ç”¨æ€§èƒ½å¥½çš„è¯­è¨€ç¼–å†™çƒ­åŠ›å›¾ç»„ä»¶, ç¼–è¯‘æ‰“åŒ…æˆä½ä»£ç å¹³å°çš„æ’ä»¶æ¥ç”¨.

<del>ğŸ˜‚ å½“ç„¶é€ è½®å­çš„å¼€å‘éš¾åº¦é¢‡é«˜, å°±å¦‚ä¸€äº›ç”µå•†å¹³å°, æ›¾ç»è¿˜æ·±åº¦ç ”ç©¶é«˜å¹¶å‘ä¸‹çš„é«˜å¯ç”¨, ç°åœ¨éƒ½é€šè¿‡å †æœåŠ¡å™¨ç®—åŠ›è§£å†³äº†, æœ‰é’±å°±æ˜¯å¤§æ™’.</del>
